# Node.js 服务器项目详细说明

## 项目概述

这是一个基于 Node.js + Express 的 Web API 服务器项目，提供通用的健康检查、认证与笔记管理等API。

## 项目架构

项目采用分层架构设计，遵循 MVC 模式：

- **路由层 (Routes)**: 处理 HTTP 请求路由
- **控制器层 (Controllers)**: 处理业务逻辑
- **服务层 (Services)**: 处理具体业务操作
- **模型层 (Models)**: 数据模型定义
- **中间件 (Middleware)**: 请求处理中间件
- **工具类 (Utils)**: 通用工具函数

## 依赖包详细说明

### 核心依赖

- **express**: Web应用框架，提供路由、中间件、模板引擎等功能
- **mongoose**: MongoDB对象建模工具，用于数据库连接和操作
- **dotenv**: 环境变量管理，从.env文件加载配置信息

### 安全相关

- **helmet**: 安全中间件，设置各种HTTP安全头，防止常见攻击
- **cors**: 跨域资源共享中间件，允许前端跨域访问API
- **express-rate-limit**: 请求频率限制，防止API滥用和DDoS攻击

### 性能优化

- **compression**: 响应压缩中间件，减少传输数据量，提高加载速度
- **morgan**: HTTP请求日志中间件，记录访问日志

### 开发工具

- **nodemon**: 开发环境自动重启工具，监听文件变化自动重启服务
- **debug**: 调试工具，用于开发环境下的日志输出

## 文件结构详解

### 根目录文件

- `package.json`: 项目配置和依赖管理
- `README.md`: 项目说明文档
- `.env`: 环境变量配置文件（需要手动创建）

### src/ 目录 - 核心源代码

```json
src/
├── server.js          # 服务器启动文件，HTTP服务器创建和配置
├── app.js             # Express应用配置，中间件和路由注册
├── config/            # 配置文件目录
│   ├── app.js         # 应用配置（端口、环境、CORS、限流等）
│   └── database.js    # 数据库连接配置
├── routes/            # 路由文件目录
│   └── index.js       # 主路由文件，整合所有子路由
├── controllers/       # 控制器目录
├── services/          # 服务层目录
├── middleware/        # 中间件目录
│   ├── security.js    # 安全相关中间件（CORS、限流、安全头）
│   ├── logger.js      # 日志中间件
│   └── errorHandler.js # 错误处理中间件
├── utils/             # 工具类目录
│   ├── response.js    # 统一响应格式工具
│   └── asyncHandler.js # 异步错误处理工具
└── validators/        # 数据验证器目录
    └── common.js      # 通用验证器
```

### public/ 目录

- 静态文件目录，存放图片等静态资源

## 安全特性

### 1. 请求限流

- 全局限流：每个IP 15分钟内最多100次请求
- API限流：每个IP 15分钟内最多50次API请求
- 健康检查不受限流影响

### 2. 安全头设置

- 通过helmet中间件设置各种安全头
- 防止XSS、CSRF等常见攻击
- 支持HTTPS和HSTS

### 3. CORS配置

- 可配置允许的源域名
- 支持凭证传递
- 限制允许的HTTP方法

## 环境配置

### 开发环境

- 端口：3000
- 数据库：本地MongoDB
- 日志级别：详细日志

### 生产环境

- 端口：通过环境变量配置
- 数据库：生产MongoDB实例
- 日志级别：简化日志格式

## 数据库配置

- 支持开发和生产环境不同配置
- 连接池管理
- 自动重连和错误处理
- 支持SSL连接（生产环境）

## 错误处理

- 全局错误处理中间件
- 异步错误包装器
- 统一错误响应格式
- 开发环境显示详细错误信息

## 日志系统

- 使用morgan中间件记录HTTP请求
- 开发环境：详细请求信息
- 生产环境：标准访问日志格式
- 跳过健康检查日志记录

## 性能优化

- 响应压缩
- 连接池管理
- 请求限流防止过载
- 静态文件服务

## 部署注意事项

1. 确保MongoDB服务可用
2. 配置正确的环境变量
3. 设置适当的文件权限
4. 配置反向代理（如Nginx）
5. 设置进程管理（如PM2）

## 扩展建议

1. 添加用户认证和授权
2. 实现缓存机制（Redis）
3. 添加API文档（Swagger）
4. 实现监控和告警
5. 添加单元测试和集成测试 